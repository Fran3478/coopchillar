import{a as f,g as v,t as k}from"./chunks/api-gnd9IJTx.js";document.addEventListener("DOMContentLoaded",()=>{h()});async function h(){const E="novedades",y="image",u=document.getElementById("titulo"),i=document.getElementById("portadaUrl"),d=document.getElementById("portadaFile"),m=document.getElementById("linkUrl"),p=document.getElementById("saveBtn");if(!u||!i||!d||!m||!p){console.warn("[admin-nueva-novedad] faltan elementos del DOM");return}function n(t,e=""){const o=document.getElementById("status");o&&(o.textContent=t,o.className=`status show ${e}`,e==="ok"&&setTimeout(()=>o.className="status",1600))}async function g(t){const e=await f("/v1/media/sign",t);if(!e.ok)throw new Error("No se pudo obtener la firma");return e.json()}async function w(t,e,o){const a=e.cloudName,s=e.resourceType||"image",c=`https://api.cloudinary.com/v1_1/${a}/${s}/upload`,r=new FormData;r.append("file",t),r.append("api_key",String(e.apiKey)),r.append("timestamp",String(e.timestamp)),r.append("signature",String(e.signature)),e.folder&&r.append("folder",e.folder),e.transformation&&r.append("transformation",e.transformation),e.eager&&r.append("eager",e.eager);const l=await fetch(c,{method:"POST",body:r});if(!l.ok)throw new Error(`Error subiendo a Cloudinary (${l.status})`);return l.json()}d.addEventListener("change",async()=>{var e;const t=(e=d.files)==null?void 0:e[0];if(t){if(!/^image\//.test(t.type))return n("Formato no soportado","err");if(t.size>10*1024*1024)return n("La imagen supera 10MB","err");try{n("Subiendo imagen…");const o=await g({resourceType:y,folder:E,incomingTransform:"c_limit,w_2560/f_webp,q_auto:good"}),a=await w(t,o);i.value=a.secure_url||"",n("Imagen subida ✅","ok")}catch(o){console.error(o),n("No se pudo subir la imagen","err")}}}),p.addEventListener("click",async()=>{try{const t=(u.value||"").trim(),e=(i.value||"").trim(),o=(m.value||"").trim();if(!t)throw new Error("Falta el título");if(!e)throw new Error("Agregá una portada");const a={tipo:"novedad",titulo:t,excerpt:"",destacado:!0,blocksJson:{time:Date.now(),blocks:[]},...e?{portadaUrl:e}:{},...o?{linkUrl:o}:{}};n("Guardando…");const s=await f("/v1/posts",a);if(!s.ok){const{text:c}=await v(s);throw new Error(c)}n("Guardado ✅","ok"),localStorage.removeItem("cms:contenido:draft"),location.href="/admin/novedades"}catch(t){console.error(t),n(k(t),"err")}})}
//# sourceMappingURL=admin-nueva-novedad.js.map
