import{b as O,c as V,g as F,t as G}from"./chunks/api-gnd9IJTx.js";import{d as it}from"./chunks/admin-uploader-l2mfM3fY.js";function J(a,o=300){let d;return(...l)=>{d&&window.clearTimeout(d),d=window.setTimeout(()=>a(...l),o)}}const K=a=>{const o={pending:"is-pending",resolved:"is-resolved"},d=a==="resolved"?"Resuelto":"Pendiente";return`<span class="badge ${o[a]||"is-pending"}">${d}</span>`},y=(a,o)=>(a||"")+(o?" "+o:""),c=a=>(a||"").replace(/[&<>\"']/g,o=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[o]);function W(a){const o=new URLSearchParams;for(const[d,l]of Object.entries(a))l!=null&&String(l).length&&o.set(d,String(l));return o.toString()}function s(a){const o=document.getElementById(a);if(!o)throw new Error(`No se encontró #${a}`);return o}document.addEventListener("DOMContentLoaded",()=>{const a=it("status",{okMs:1600,errMs:5e3});let o=1,d=10,l=0,k=[],q="",I="",N="";const m=s("c-rows"),X=s("c-info"),x=s("c-prev"),A=s("c-next"),R=s("c-q"),P=s("c-cat"),z=s("c-status"),S=s("contactModal"),Y=s("contactDetail"),Z=s("closeContactModal");let g=1,$=10,v=0,L=[],D="",H="";const b=s("e-rows"),_=s("e-info"),C=s("e-prev"),T=s("e-next"),U=s("e-q"),j=s("e-status"),M=s("ebillingModal"),tt=s("ebillingDetail"),et=s("closeEbillingModal");function ot(t){const e=y(t.nombre,t.apellido),i=t.categoria||"—",n=t.email||"—",u=t.telefono||"—",E=t.status||"pending",h=t.handledByUserId!=null?`#${t.handledByUserId}`:"—",f=E==="pending"?`<button class="kbtn success solid c-resolve" data-id="${t.id}">Resolver</button>`:`<button class="kbtn ghost c-reopen" data-id="${t.id}">Reabrir</button>`;return`<tr>
      <td>${c(e||"—")}</td>
      <td class="hidem">${c(i)}</td>
      <td class="hidem">${c(n)}</td>
      <td class="hidem">${c(u)}</td>
      <td class="hidem">${K(E)}</td>
      <td class="hidem">${c(h)}</td>
      <td class="td actions">
        <div class="row-actions">
          <button class="kbtn c-view" data-id="${t.id}">Ver</button>
          ${f}
        </div>
      </td>
    </tr>`}function nt(t){const e=k.find(n=>String(n.id)===String(t));if(!e)return;const i=[["Nombre",y(e.nombre,e.apellido)||"—"],["Categoría",e.categoria||"—"],["Email",e.email||"—"],["Teléfono",e.telefono||"—"],["Socio Nº",e.socioNumero??"—"],["DNI",e.dni??"—"],["Estado",e.status==="resolved"?"Resuelto":"Pendiente"],["Resuelto por",e.handledByUserId!=null?`#${e.handledByUserId}`:"—"],["Detalle",e.detalle||"—"]];Y.innerHTML=i.map(([n,u])=>`<div class="row"><b>${c(n)}</b><div>${c(String(u))}</div></div>`).join(""),S.showModal()}async function B(t,e){if(confirm(e==="resolved"?"¿Marcar como resuelto?":"¿Reabrir contacto?"))try{a.show("Actualizando…");const n=await V(`/v1/contacts/${encodeURIComponent(t)}/status`,{status:e});if(!n.ok){const{text:u}=await F(n);return a.show(u||"No se pudo actualizar","err")}await p(),a.show("Actualizado ✅","ok")}catch(n){console.error(n),a.show(G(n)||"No se pudo actualizar","err")}}async function p(){try{m.innerHTML='<tr><td colspan="7" class="empty">Cargando…</td></tr>';const t=W({page:String(o),pageSize:String(d),q:q||void 0,categoria:I||void 0,status:N||void 0}),e=await O(`/v1/contacts?${t}`);if(!e.ok)throw new Error(await e.text());const i=await e.json();l=i.total||0,k=Array.isArray(i.items)?i.items:[],k.length?(m.innerHTML=k.map(ot).join(""),m.querySelectorAll(".c-view").forEach(r=>r.addEventListener("click",()=>nt(r.dataset.id||""))),m.querySelectorAll(".c-resolve").forEach(r=>r.addEventListener("click",()=>B(r.dataset.id||"","resolved"))),m.querySelectorAll(".c-reopen").forEach(r=>r.addEventListener("click",()=>B(r.dataset.id||"","pending")))):m.innerHTML='<tr><td colspan="7" class="empty">Sin resultados</td></tr>';const n=Math.max(1,Math.ceil(l/d)),u=l?(o-1)*d+1:0,E=Math.min(o*d,l);X.textContent=l?`${u}-${E} de ${l}`:"0 resultados";const h=o<=1,f=o>=n;x.disabled=h,A.disabled=f,x.setAttribute("aria-disabled",String(h)),A.setAttribute("aria-disabled",String(f))}catch(t){console.error(t),m.innerHTML='<tr><td colspan="7" class="empty">Error cargando</td></tr>',a.show("Error cargando contactos","err")}}function at(t){const e=y(t.nombre,t.apellido),i=t.status||"pending",n=i==="pending"?`<button class="kbtn success solid e-resolve" data-id="${t.id}">Resolver</button>`:`<button class="kbtn ghost e-reopen" data-id="${t.id}">Reabrir</button>`;return`<tr>
      <td>${c(String(t.abonadoNumero??"—"))}</td>
      <td>${c(e||"—")}</td>
      <td class="hidem">${c(String(t.dniCuit??"—"))}</td>
      <td class="hidem">${c(t.email||"—")}</td>
      <td class="hidem">${c(t.telefono||"—")}</td>
      <td class="hidem">${K(i)}</td>
      <td class="td actions">
        <div class="row-actions">
          <button class="kbtn e-view" data-id="${t.id}">Ver</button>
          ${n}
        </div>
      </td>
    </tr>`}function st(t){const e=L.find(n=>String(n.id)===String(t));if(!e)return;const i=[["Abonado Nº",e.abonadoNumero??"—"],["DNI/CUIT",e.dniCuit??"—"],["Nombre",y(e.nombre,e.apellido)||"—"],["Email",e.email||"—"],["Teléfono",e.telefono||"—"],["Estado",e.status==="resolved"?"Resuelto":"Pendiente"]];tt.innerHTML=i.map(([n,u])=>`<div class="row"><b>${c(n)}</b><div>${c(String(u))}</div></div>`).join(""),M.showModal()}async function Q(t,e){if(confirm(e==="resolved"?"¿Marcar como resuelto?":"¿Reabrir solicitud?"))try{a.show("Actualizando…");const n=await V(`/v1/ebilling-requests/${encodeURIComponent(t)}/status`,{status:e});if(!n.ok){const{text:u}=await F(n);return a.show(u||"No se pudo actualizar","err")}await w(),a.show("Actualizado ✅","ok")}catch(n){console.error(n),a.show(G(n)||"No se pudo actualizar","err")}}async function w(){try{b.innerHTML='<tr><td colspan="7" class="empty">Cargando…</td></tr>';const t=W({page:String(g),pageSize:String($),q:D||void 0,status:H||void 0}),e=await O(`/v1/ebilling-requests?${t}`);if(!e.ok)throw new Error(await e.text());const i=await e.json();v=i.total||0,L=Array.isArray(i.items)?i.items:[],L.length?(b.innerHTML=L.map(at).join(""),b.querySelectorAll(".e-view").forEach(r=>r.addEventListener("click",()=>st(r.dataset.id||""))),b.querySelectorAll(".e-resolve").forEach(r=>r.addEventListener("click",()=>Q(r.dataset.id||"","resolved"))),b.querySelectorAll(".e-reopen").forEach(r=>r.addEventListener("click",()=>Q(r.dataset.id||"","pending")))):b.innerHTML='<tr><td colspan="7" class="empty">Sin resultados</td></tr>';const n=Math.max(1,Math.ceil(v/$)),u=v?(g-1)*$+1:0,E=Math.min(g*$,v);_.textContent=v?`${u}-${E} de ${v}`:"0 resultados";const h=g<=1,f=g>=n;C.disabled=h,T.disabled=f,C.setAttribute("aria-disabled",String(h)),T.setAttribute("aria-disabled",String(f))}catch(t){console.error(t),b.innerHTML='<tr><td colspan="7" class="empty">Error cargando</td></tr>',a.show("Error cargando adhesiones","err")}}R.addEventListener("input",J(()=>{q=(R.value||"").trim(),o=1,p()},300)),P.addEventListener("change",()=>{I=P.value||"",o=1,p()}),z.addEventListener("change",()=>{N=z.value||"",o=1,p()}),x.addEventListener("click",()=>{o>1&&(o--,p())}),A.addEventListener("click",()=>{const t=Math.max(1,Math.ceil(l/d));o<t&&(o++,p())}),U.addEventListener("input",J(()=>{D=(U.value||"").trim(),g=1,w()},300)),j.addEventListener("change",()=>{H=j.value||"",g=1,w()}),C.addEventListener("click",()=>{g>1&&(g--,w())}),T.addEventListener("click",()=>{const t=Math.max(1,Math.ceil(v/$));g<t&&(g++,w())}),S.addEventListener("click",t=>{t.target===S&&S.close()}),M.addEventListener("click",t=>{t.target===M&&M.close()}),Z.addEventListener("click",()=>S.close()),et.addEventListener("click",()=>M.close()),p(),w()});
//# sourceMappingURL=admin-contactos.js.map
