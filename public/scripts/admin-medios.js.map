{"version":3,"file":"admin-medios.js","sources":["../../src/scripts/admin-medios.ts"],"sourcesContent":["import { apiFetch } from \"../lib/api\";\r\n\r\nconst FOLDERS_URL = \"/v1/media/folders\";\r\nconst ASSETS_URL = \"/v1/media/assets\";\r\nconst DELETE_URL = \"/v1/media/asset\";\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  void main();\r\n});\r\n\r\nasync function main() {\r\n  const treeEl = document.getElementById(\"folderTree\") as HTMLElement | null;\r\n  const grid = document.getElementById(\"grid\") as HTMLElement | null;\r\n\r\n  const reloadBtn = document.getElementById(\"reload\") as HTMLButtonElement | null;\r\n  const prevBtn = document.getElementById(\"prev\") as HTMLButtonElement | null;\r\n  const nextBtn = document.getElementById(\"next\") as HTMLButtonElement | null;\r\n  const info = document.getElementById(\"info\") as HTMLElement | null;\r\n\r\n  const toast = document.getElementById(\"toast\") as HTMLElement | null;\r\n  const usedSeg = document.querySelector(\".used-filter\") as HTMLElement | null;\r\n\r\n  const previewModal = document.getElementById(\"previewModal\") as HTMLDialogElement | null;\r\n  const previewTitle = document.getElementById(\"previewTitle\") as HTMLElement | null;\r\n  const previewBody = document.getElementById(\"previewBody\") as HTMLElement | null;\r\n  const previewMeta = document.getElementById(\"previewMeta\") as HTMLElement | null;\r\n  const previewCopy = document.getElementById(\"previewCopy\") as HTMLButtonElement | null;\r\n  const previewOpen = document.getElementById(\"previewOpen\") as HTMLButtonElement | null;\r\n  const previewClose = document.getElementById(\"previewClose\") as HTMLButtonElement | null;\r\n\r\n  if (!treeEl || !grid || !reloadBtn || !prevBtn || !nextBtn || !info || !toast || !previewModal || !previewTitle || !previewBody || !previewMeta || !previewCopy || !previewOpen || !previewClose) {\r\n    console.warn(\"[admin-medios] Faltan elementos del DOM. Abortando init.\");\r\n    return;\r\n  }\r\n\r\n  function toastMsg(msg: string) {\r\n    toast.textContent = msg;\r\n    toast.className = \"toast show\";\r\n    setTimeout(() => (toast.className = \"toast\"), 1600);\r\n  }\r\n\r\n  const state = {\r\n    folder: \"all\",\r\n    cursor: null as string | null,\r\n    prevStack: [] as (string | null)[],\r\n    totalApprox: 0,\r\n    lastItems: [] as any[],\r\n    used: \"all\",\r\n  };\r\n\r\n  function buildTree(folders: any[]) {\r\n    const root: any = { children: new Map<string, any>() };\r\n    const labelByPath = new Map(\r\n      folders.map((f) => [f.path, f.name || String(f.path).split(\"/\").pop()])\r\n    );\r\n\r\n    for (const f of folders) {\r\n      const parts = String(f.path).split(\"/\");\r\n      let node = root;\r\n      const acc: string[] = [];\r\n      for (let i = 0; i < parts.length; i++) {\r\n        const part = parts[i];\r\n        acc.push(part);\r\n        const p = acc.join(\"/\");\r\n        if (!node.children.has(part)) {\r\n          node.children.set(part, {\r\n            key: p,\r\n            label: labelByPath.get(p) || part,\r\n            children: new Map<string, any>(),\r\n          });\r\n        }\r\n        node = node.children.get(part);\r\n      }\r\n    }\r\n    return root;\r\n  }\r\n\r\n  function renderTreeNode(node: any, parent: HTMLElement) {\r\n    const entries = Array.from(node.children.values()).sort((a: any, b: any) =>\r\n      a.label.localeCompare(b.label, \"es\")\r\n    );\r\n\r\n    for (const n of entries) {\r\n      const li = document.createElement(\"li\");\r\n      const hasChildren = n.children.size > 0;\r\n      li.innerHTML = `\r\n        <button class=\"node ${state.folder === n.key ? \"active\" : \"\"}\" data-path=\"${n.key}\">\r\n          ${hasChildren ? `<span class=\"chev\">▾</span>` : `<span class=\"leaf\" aria-hidden=\"true\"></span>`}\r\n          <span class=\"label\">${escapeHtml(n.label)}</span>\r\n        </button>\r\n      `;\r\n      parent.appendChild(li);\r\n\r\n      if (hasChildren) {\r\n        const ul = document.createElement(\"ul\");\r\n        li.appendChild(ul);\r\n        renderTreeNode(n, ul);\r\n      }\r\n    }\r\n  }\r\n\r\n  async function loadFolders() {\r\n    treeEl.innerHTML = \"\";\r\n\r\n    const rootBtn = document.createElement(\"button\");\r\n    rootBtn.className = \"node \" + (state.folder === \"all\" ? \"active\" : \"\");\r\n    rootBtn.dataset.path = \"all\";\r\n    rootBtn.innerHTML = `<span class=\"chev\" aria-hidden=\"true\">●</span><span class=\"label\">Todas</span>`;\r\n    treeEl.appendChild(rootBtn);\r\n\r\n    try {\r\n      const res = await apiFetch(FOLDERS_URL, { method: \"GET\" });\r\n      if (!res.ok) throw new Error(await res.text());\r\n      const { folders = [] } = await res.json();\r\n      const t = buildTree(folders);\r\n      const ul = document.createElement(\"ul\");\r\n      treeEl.appendChild(ul);\r\n      renderTreeNode(t, ul);\r\n    } catch (err) {\r\n      console.error(err);\r\n      const div = document.createElement(\"div\");\r\n      div.className = \"sub\";\r\n      div.style.padding = \".4rem .6rem\";\r\n      div.textContent = \"No se pudieron cargar carpetas\";\r\n      treeEl.appendChild(div);\r\n    }\r\n  }\r\n\r\n  treeEl.addEventListener(\"click\", (e) => {\r\n    const b = (e.target as HTMLElement).closest(\".node\") as HTMLButtonElement | null;\r\n    if (!b) return;\r\n\r\n    const path = b.dataset.path || \"all\";\r\n    if (path === state.folder) return;\r\n\r\n    state.folder = path;\r\n    state.cursor = null;\r\n    state.prevStack = [];\r\n\r\n    treeEl.querySelectorAll(\".node\").forEach((n) =>\r\n      n.classList.toggle(\"active\", n === b)\r\n    );\r\n\r\n    void listAssets();\r\n  });\r\n\r\n  async function listAssets({ cursor = null as string | null } = {}) {\r\n    grid.innerHTML = `<div class=\"media-card\" style=\"padding:1rem\">Cargando…</div>`;\r\n    try {\r\n      const params = new URLSearchParams();\r\n      if (state.folder && state.folder !== \"all\") params.set(\"folder\", state.folder);\r\n      if (state.used !== \"all\") params.set(\"used\", state.used);\r\n      if (cursor) params.set(\"cursor\", cursor);\r\n\r\n      const res = await apiFetch(`${ASSETS_URL}?${params.toString()}`, { method: \"GET\" });\r\n\r\n      if (!res.ok) {\r\n        const j = await res.json().catch(() => ({} as any));\r\n        grid.innerHTML = `<div class=\"media-card\" style=\"padding:1rem;color:#a3122a\">Error: ${escapeHtml(j.error || String(res.status))}</div>`;\r\n        nextBtn.disabled = prevBtn.disabled = true;\r\n        info.textContent = \"\";\r\n        return;\r\n      }\r\n\r\n      const j = await res.json();\r\n      let items: any[] = Array.isArray(j.items) ? j.items : [];\r\n\r\n      // si querés filtrar client-side por \"used\" (además del server)\r\n      if (state.used !== \"all\") {\r\n        const want = state.used === \"true\";\r\n        items = items.filter((it) => !!it.used === want);\r\n      }\r\n\r\n      state.lastItems = items;\r\n      state.totalApprox = j.totalCountApprox ?? 0;\r\n\r\n      renderGrid(items);\r\n\r\n      nextBtn.disabled = !j.nextCursor;\r\n      (nextBtn as any).dataset.cursor = j.nextCursor || \"\";\r\n\r\n      prevBtn.disabled = state.prevStack.length === 0;\r\n\r\n      info.textContent = state.totalApprox ? `~${state.totalApprox} elementos` : \"\";\r\n    } catch (err) {\r\n      console.error(err);\r\n      grid.innerHTML = `<div class=\"media-card\" style=\"padding:1rem;color:#a3122a\">Error listando medios</div>`;\r\n      nextBtn.disabled = prevBtn.disabled = true;\r\n      info.textContent = \"\";\r\n    }\r\n  }\r\n\r\n  function renderGrid(items: any[]) {\r\n    if (items.length === 0) {\r\n      grid.innerHTML = `<div class=\"media-card\" style=\"padding:1rem\">Sin resultados</div>`;\r\n      return;\r\n    }\r\n\r\n    grid.innerHTML = \"\";\r\n    for (const it of items) {\r\n      const id = it.publicId || it.public_id || \"\";\r\n      const url = it.secureUrl || it.secure_url || it.url || \"\";\r\n      const w = it.width || 0;\r\n      const h = it.height || 0;\r\n      const fmt = it.format || \"\";\r\n      const folder = it.folder || \"\";\r\n      const rtype = it.resourceType || it.resource_type || \"image\";\r\n      const used = !!it.used;\r\n      const name = String(id || \"\").split(\"/\").pop();\r\n\r\n      const card = document.createElement(\"div\");\r\n      card.className = \"media-card\";\r\n      (card as any).dataset.publicId = id;\r\n      (card as any).dataset.url = url;\r\n      (card as any).dataset.kind = rtype;\r\n\r\n      card.innerHTML = `\r\n        <div class=\"thumb\">\r\n          ${\r\n            rtype === \"video\"\r\n              ? `<video src=\"${escapeAttr(url)}\" muted playsinline preload=\"metadata\"></video>`\r\n              : url\r\n                ? `<img src=\"${escapeAttr(url)}\" alt=\"${escapeAttr(name || \"\")}\">`\r\n                : `<span>sin vista</span>`\r\n          }\r\n        </div>\r\n        <div class=\"meta\">\r\n          <div class=\"name\" title=\"${escapeAttr(id)}\">${escapeHtml(name || \"(sin nombre)\")}</div>\r\n          <div class=\"sub\">${escapeHtml(String(w || \"?\"))}×${escapeHtml(String(h || \"?\"))} · ${escapeHtml(fmt || \"?\")}</div>\r\n          <div class=\"row\">\r\n            ${folder ? `<span class=\"tag\">${escapeHtml(folder)}</span>` : \"\"}\r\n            ${rtype === \"video\" ? `<span class=\"tag\">video</span>` : \"\"}\r\n            <span class=\"badge ${used ? \"is-used\" : \"is-unused\"}\">${used ? \"En uso\" : \"Libre\"}</span>\r\n          </div>\r\n          <div class=\"ops\">\r\n            <button class=\"kbtn\" data-act=\"copy\" data-url=\"${escapeAttr(url)}\">Copiar URL</button>\r\n            <button class=\"kbtn danger solid\" data-act=\"del\" data-id=\"${encodeURIComponent(id)}\">Eliminar</button>\r\n          </div>\r\n        </div>\r\n      `;\r\n\r\n      card.addEventListener(\"click\", (e) => {\r\n        if ((e.target as HTMLElement).closest(\"button\")) return;\r\n        openPreview(it);\r\n      });\r\n\r\n      grid.appendChild(card);\r\n    }\r\n  }\r\n\r\n  grid.addEventListener(\"click\", async (e) => {\r\n    const btn = (e.target as HTMLElement).closest(\"button\") as HTMLButtonElement | null;\r\n    if (!btn) return;\r\n\r\n    const act = (btn as any).dataset.act;\r\n\r\n    if (act === \"copy\") {\r\n      const u = (btn as any).dataset.url || \"\";\r\n      if (!u) return;\r\n      await navigator.clipboard.writeText(u);\r\n      toastMsg(\"URL copiada\");\r\n      e.stopPropagation();\r\n      return;\r\n    }\r\n\r\n    if (act === \"del\") {\r\n      const id = (btn as any).dataset.id ? decodeURIComponent((btn as any).dataset.id) : \"\";\r\n      if (!id) return;\r\n\r\n      e.stopPropagation();\r\n      if (!confirm(`¿Eliminar \"${id}\"?`)) return;\r\n\r\n      const res = await apiFetch(`${DELETE_URL}?publicId=${encodeURIComponent(id)}`, { method: \"DELETE\" });\r\n      if (res.ok) {\r\n        toastMsg(\"Eliminado\");\r\n        await listAssets();\r\n      } else {\r\n        const j = await res.json().catch(() => ({} as any));\r\n        alert(j.error || \"No se pudo eliminar\");\r\n      }\r\n    }\r\n  });\r\n\r\n  nextBtn.addEventListener(\"click\", () => {\r\n    const cur = (nextBtn as any).dataset.cursor as string | undefined;\r\n    if (cur) {\r\n      state.prevStack.push(cur);\r\n      void listAssets({ cursor: cur });\r\n    }\r\n  });\r\n\r\n  prevBtn.addEventListener(\"click\", () => {\r\n    state.prevStack.pop();\r\n    const prev = state.prevStack[state.prevStack.length - 1] || null;\r\n    void listAssets({ cursor: prev || null });\r\n  });\r\n\r\n  usedSeg?.addEventListener(\"click\", (e) => {\r\n    const btn = (e.target as HTMLElement).closest(\".seg-btn\") as HTMLElement | null;\r\n    if (!btn) return;\r\n\r\n    usedSeg.querySelectorAll(\".seg-btn\").forEach((b) =>\r\n      b.classList.toggle(\"active\", b === btn)\r\n    );\r\n\r\n    state.used = (btn as any).dataset.used || \"all\";\r\n    state.cursor = null;\r\n    state.prevStack = [];\r\n    void listAssets();\r\n  });\r\n\r\n  reloadBtn.addEventListener(\"click\", () => void listAssets());\r\n\r\n  function openPreview(it: any) {\r\n    const id = it.publicId || it.public_id || \"\";\r\n    const url = it.secureUrl || it.secure_url || it.url || \"\";\r\n    const w = it.width || 0;\r\n    const h = it.height || 0;\r\n    const fmt = it.format || \"\";\r\n    const folder = it.folder || \"\";\r\n    const used = !!it.used;\r\n    const rtype = it.resourceType || it.resource_type || \"image\";\r\n    const created = it.createdAt || it.created_at || \"\";\r\n\r\n    previewTitle.textContent = String(id || \"\").split(\"/\").pop() || \"Vista previa\";\r\n    previewBody.innerHTML = \"\";\r\n\r\n    if (rtype === \"video\") {\r\n      const v = document.createElement(\"video\");\r\n      v.src = url;\r\n      v.controls = true;\r\n      v.playsInline = true;\r\n      previewBody.appendChild(v);\r\n    } else {\r\n      const img = document.createElement(\"img\");\r\n      img.src = url;\r\n      img.alt = previewTitle.textContent || \"\";\r\n      previewBody.appendChild(img);\r\n    }\r\n\r\n    const usages = Array.isArray(it.usages) ? it.usages : [];\r\n    const usageText = usages.length\r\n      ? usages\r\n          .map((u: any) => `${escapeHtml(u.kind || \"\")}${u.titulo ? ` — ${escapeHtml(u.titulo)}` : \"\"}`)\r\n          .join(\"<br>\")\r\n      : \"—\";\r\n\r\n    previewMeta.innerHTML = [\r\n      [\"Archivo\", id || \"—\"],\r\n      [\"Carpeta\", folder || \"—\"],\r\n      [\"Tamaño\", `${w || \"?\"} × ${h || \"?\"}`],\r\n      [\"Formato\", fmt || \"—\"],\r\n      [\"Creado\", created ? new Date(created).toLocaleString(\"es-AR\") : \"—\"],\r\n      [\"Estado\", used ? \"En uso\" : \"Libre\"],\r\n      [\"Usos\", usageText],\r\n    ]\r\n      .map(([k, v]) => `<div class=\"row\"><b>${escapeHtml(k)}</b><div>${String(v)}</div></div>`)\r\n      .join(\"\");\r\n\r\n    (previewCopy as any).dataset.url = url;\r\n    (previewOpen as any).dataset.url = url;\r\n\r\n    previewModal.showModal();\r\n  }\r\n\r\n  previewCopy.addEventListener(\"click\", async () => {\r\n    const u = (previewCopy as any).dataset.url || \"\";\r\n    if (!u) return;\r\n    await navigator.clipboard.writeText(u);\r\n    toastMsg(\"URL copiada\");\r\n  });\r\n\r\n  previewOpen.addEventListener(\"click\", () => {\r\n    const u = (previewOpen as any).dataset.url || \"\";\r\n    if (!u) return;\r\n    window.open(u, \"_blank\", \"noopener,noreferrer\");\r\n  });\r\n\r\n  previewClose.addEventListener(\"click\", () => previewModal.close());\r\n  previewModal.addEventListener(\"click\", (e) => {\r\n    if (e.target === previewModal) previewModal.close();\r\n  });\r\n\r\n  await loadFolders();\r\n  await listAssets();\r\n}\r\n\r\nfunction escapeHtml(str: any) {\r\n  return String(str || \"\").replace(/[&<>\"']/g, (m) => ({ \"&\": \"&amp;\", \"<\": \"&lt;\", \">\": \"&gt;\", '\"': \"&quot;\", \"'\": \"&#039;\" }[m] as string));\r\n}\r\nfunction escapeAttr(str: any) {\r\n  return String(str || \"\").replace(/\"/g, \"&quot;\");\r\n}\r\n"],"names":["FOLDERS_URL","ASSETS_URL","DELETE_URL","main","treeEl","grid","reloadBtn","prevBtn","nextBtn","info","toast","usedSeg","previewModal","previewTitle","previewBody","previewMeta","previewCopy","previewOpen","previewClose","toastMsg","msg","state","buildTree","folders","root","labelByPath","f","parts","node","acc","i","part","p","renderTreeNode","parent","entries","a","b","li","hasChildren","escapeHtml","ul","loadFolders","rootBtn","res","apiFetch","t","err","div","path","listAssets","cursor","params","j","items","want","it","renderGrid","id","url","w","h","fmt","folder","rtype","used","name","card","escapeAttr","e","openPreview","btn","act","u","cur","prev","created","v","img","usages","usageText","k","str","m"],"mappings":"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"}