import{a as _,m as I,c as S,r as O,u as D,b as R,A as j,P as G,G as V,v as W,d as Y,g as K,t as Q}from"./chunks/admin-uploader-3KBZ3FC9.js";const z=W,X=V,Z=G,w="cms:contenido:draft",C="cms:postmeta:draft:new";function ee(e){const t=document.getElementById(e);if(!t)throw new Error(`No se encontró #${e}`);return t}function F(e){if(!e)return!1;try{return new URL(e),!0}catch{return!1}}function r(e,t=""){const i=document.getElementById("status");if(i){if(!e){i.textContent="",i.className="status";return}i.textContent=e,i.className=`status show ${t}`,t==="ok"&&setTimeout(()=>i.className="status",1600)}}function H(){document.querySelectorAll(".invalid").forEach(e=>e.classList.remove("invalid","is-invalid")),document.querySelectorAll(".err-tip").forEach(e=>e.remove())}function te(e){return{titulo:"Título",excerpt:"Resumen",portadaUrl:"URL de la portada",destacado:"Destacado",linkUrl:"Enlace",tipo:"Tipo",blocksJson:"Contenido"}[e]||e}function oe(e){H();for(const{field:t,message:i}of e){const s=t==="titulo"&&document.getElementById("titulo")||t==="excerpt"&&document.getElementById("excerpt")||t==="portadaUrl"&&document.getElementById("portadaUrl")||t==="destacado"&&document.getElementById("destacado")||t==="linkUrl"&&document.getElementById("linkUrl")||t==="tipo"&&document.getElementById("tipo")||null;s&&I(s,`${te(t)}: ${i||"Dato inválido"}`)}}function ae(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[t])}let k=!1,U=null;function M(){k=!0,U&&window.clearTimeout(U),U=window.setTimeout(ne,600)}function ne(){U=null;const e=document.getElementById("tipo"),t=document.getElementById("titulo"),i=document.getElementById("excerpt"),s=document.getElementById("portadaUrl"),g=document.getElementById("destacado"),f=document.getElementById("linkUrl"),c={tipo:(e==null?void 0:e.value)==="novedad"?"novedad":"noticia",titulo:((t==null?void 0:t.value)||"").trim(),excerpt:((i==null?void 0:i.value)||"").trim(),portadaUrl:((s==null?void 0:s.value)||"").trim(),destacado:!!(g!=null&&g.checked),linkUrl:(e==null?void 0:e.value)==="novedad"&&((f==null?void 0:f.value)||"").trim()||null};localStorage.setItem(C,JSON.stringify(c))}function re(){const e=localStorage.getItem(C);if(!e)return null;try{return JSON.parse(e)}catch{return null}}function ie(){window.addEventListener("beforeunload",e=>{k&&(e.preventDefault(),e.returnValue="")})}async function P(){const e=ee("editorjs"),t=e.dataset.folder||"pages",s=e.dataset.resourceType==="video"?"video":"image",g=document.getElementById("saveBtn"),f=document.getElementById("previewBtn"),c=document.getElementById("tipo"),v=document.getElementById("titulo"),p=document.getElementById("excerpt"),d=document.getElementById("portadaUrl"),l=document.getElementById("portadaFile"),T=document.getElementById("destacado"),y=document.getElementById("linkUrl");[c,v,p,d,T,y].forEach(n=>{if(!n)return;const o=()=>{R(n),M()};n.addEventListener("input",o),n.addEventListener("change",o)}),l==null||l.addEventListener("change",async n=>{var h;const o=n.currentTarget,m=(h=o==null?void 0:o.files)==null?void 0:h[0];if(!(!m||!d)){try{_(m,10)}catch(a){I(l,(a==null?void 0:a.message)||"Archivo inválido"),S(l),r((a==null?void 0:a.message)||"Archivo inválido","err");return}try{r("Subiendo portada…");const a=await O({resourceType:s,folder:`${t}/portadas`,incomingTransform:"c_limit,w_2560/f_webp,q_auto:good"}),B=await D(m,a);d.value=B.secure_url,R(l),S(l),r("Imagen subida ✅","ok"),M()}catch(a){console.error(a),I(l,(a==null?void 0:a.message)||"No se pudo subir la imagen"),S(l),r((a==null?void 0:a.message)||"No se pudo subir la imagen","err")}}});const u=re();u&&(c&&(c.value=u.tipo),v&&(v.value=u.titulo||""),p&&(p.value=u.excerpt||""),d&&(d.value=u.portadaUrl||""),T&&(T.checked=!!u.destacado),y&&u.tipo==="novedad"&&(y.value=u.linkUrl||""),k=!0);const J={class:Z,config:{captionPlaceholder:"Pie de imagen",uploader:{async uploadByFile(n){_(n,10),r("Subiendo imagen…");const o=await O({resourceType:s,folder:t,incomingTransform:"c_limit,w_2560/f_webp,q_auto:good"}),m=await D(n,o);return r("",""),{success:1,file:{url:m.secure_url}}}}}},L=new j({holder:"editorjs",autofocus:!0,placeholder:"Escribí acá…",i18n:{messages:{ui:{toolbar:{toolbox:{Add:"Añadir bloque",Filter:"Buscar","Nothing found":"Sin resultados"},converter:{"Convert to":"Convertir a"}},blockTunes:{toggler:{"Click to tune":"Ajustes","or move":"o mover"}},popover:{Filter:"Buscar","Nothing found":"Sin resultados","Convert to":"Convertir a"}},toolNames:{Paragraph:"Párrafo",Text:"Párrafo",Header:"Título",Heading:"Título",Image:"Imagen",Checklist:"Lista de tareas","Unordered List":"Lista con viñetas","Ordered List":"Lista numerada","Unordered list":"Lista con viñetas","Ordered list":"Lista numerada",Warning:"Advertencia",Quote:"Cita",Italic:"Itálica",Bold:"Negrita"},blockTunes:{delete:{Delete:"Eliminar","Click to delete":"Click para confirmar"},moveUp:{"Move up":"Mover arriba"},moveDown:{"Move down":"Mover abajo"}},tools:{list:{Ordered:"Numerada",Unordered:"Viñetas"},image:{Caption:"Pie de imagen","Select an Image":"Seleccionar imagen","With border":"Con borde","Stretch image":"Estirar imagen","With background":"Con fondo"},header:{Heading:"Título","Heading 2":"Título 2","Heading 3":"Título 3","Heading 4":"Título 4"},checklist:{Checklist:"Lista de tareas","Add an item":"Agregar ítem"},link:{"Add a link":"Añadir un enlace"}}}},tools:{header:{class:z,inlineToolbar:!0,toolbox:{title:"Título"},config:{levels:[2,3,4],defaultLevel:2}},list:{class:X,inlineToolbar:!0,toolbox:{title:"Lista"}},image:J},data:JSON.parse(localStorage.getItem(w)||'{"time":0,"blocks":[{"type":"paragraph","data":{"text":""}}],"version":"2.29.0"}'),onChange:async()=>{try{const n=await L.save();localStorage.setItem(w,JSON.stringify(n)),k=!0}catch{}}});ie(),g==null||g.addEventListener("click",async()=>{try{r("Guardando…");const n=JSON.parse(localStorage.getItem(w)||"null")||await L.save(),o=(c==null?void 0:c.value)==="novedad"?"novedad":"noticia",m=((v==null?void 0:v.value)??"").trim(),h=((p==null?void 0:p.value)??"").trim(),a=((d==null?void 0:d.value)??"").trim(),B=o==="novedad"?!0:!!(T!=null&&T.checked),b=o==="novedad"?((y==null?void 0:y.value)??"").trim():"";if(H(),!m){I(v,"El título es obligatorio"),r("Falta el título","err");return}if(a&&!F(a)){I(d,"URL de portada inválida"),r("URL inválida: Portada","err");return}if(o==="novedad"&&b&&!F(b)){I(y,"URL inválida"),r("URL inválida: Enlace","err");return}if(h&&h.length>240){I(p,"Máximo 240 caracteres"),r("Resumen demasiado largo (máx 240)","err");return}const E={tipo:o,titulo:m,blocksJson:n};if(h&&(E.excerpt=h),B&&(E.destacado=!0),a&&(E.portadaUrl=a),o==="novedad"&&b&&(E.linkUrl=b),E.destacado&&!E.portadaUrl)throw new Error("Si es destacada, agregá una portada");const x=await Y("/v1/posts",E);if(!x.ok){const{text:$,fieldErrors:N}=await K(x);N.length&&oe(N.map(A=>({field:A.field,message:A.message||"Dato inválido"}))),r($,"err");return}localStorage.removeItem(w),localStorage.removeItem(C),k=!1,r("Guardado ✅","ok");const q=o==="novedad"?"/admin/novedades":"/admin/noticias";location.href=q}catch(n){console.error(n),r(Q(n),"err")}}),f==null||f.addEventListener("click",async()=>{try{const n=await L.save(),o=window.open("","_blank");o==null||o.document.write(`<pre style="padding:16px;font-family:ui-monospace,Menlo,Consolas,monospace">${ae(JSON.stringify(n,null,2))}</pre>`),o==null||o.document.close()}catch{}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",P,{once:!0}):P();
//# sourceMappingURL=content-editor.js.map
