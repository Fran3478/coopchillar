{"version":3,"file":"admin-usuarios.js","sources":["../../src/scripts/admin-usuarios.ts"],"sourcesContent":["import {\r\n  apiGet,\r\n  apiPost,\r\n  apiPut,\r\n  getErrorInfo,\r\n  toErrorText,\r\n  clientGetMe,\r\n} from \"../lib/api\";\r\n\r\nimport { makeToaster, markInvalid } from \"../lib/admin-uploader\";\r\n\r\ntype AnyUser = any;\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  void boot();\r\n});\r\n\r\nconst toast = makeToaster(\"status\", { okMs: 1600, errMs: 5000 });\r\n\r\nlet me: any = null;\r\nlet canEdit = false;\r\n\r\nlet page = 1;\r\nconst pageSize = 10;\r\nlet total = 0;\r\nlet q = \"\";\r\nlet roleFilter = \"\";\r\nlet items: AnyUser[] = [];\r\n\r\nconst rowsEl = document.getElementById(\"rows\") as HTMLTableSectionElement | null;\r\nconst pageInfo = document.getElementById(\"pageInfo\") as HTMLSpanElement | null;\r\nconst prevBtn = document.getElementById(\"prev\") as HTMLButtonElement | null;\r\nconst nextBtn = document.getElementById(\"next\") as HTMLButtonElement | null;\r\n\r\nconst newBtn = document.getElementById(\"newBtn\") as HTMLButtonElement | null;\r\nconst qEl = document.getElementById(\"q\") as HTMLInputElement | null;\r\nconst roleFilterEl = document.getElementById(\"roleFilter\") as HTMLSelectElement | null;\r\n\r\nconst userModal = document.getElementById(\"userModal\") as HTMLDialogElement | null;\r\nconst userForm = document.getElementById(\"userForm\") as HTMLFormElement | null;\r\nconst userFormTitle = document.getElementById(\"userFormTitle\") as HTMLElement | null;\r\nconst userIdEl = document.getElementById(\"userId\") as HTMLInputElement | null;\r\nconst emailEl = document.getElementById(\"email\") as HTMLInputElement | null;\r\nconst roleEl = document.getElementById(\"role\") as HTMLSelectElement | null;\r\nconst cancelUser = document.getElementById(\"cancelUser\") as HTMLButtonElement | null;\r\n\r\nconst resetModal = document.getElementById(\"resetModal\") as HTMLDialogElement | null;\r\nconst resetTokenEl = document.getElementById(\"resetToken\") as HTMLInputElement | null;\r\nconst copyTokenBtn = document.getElementById(\"copyToken\") as HTMLButtonElement | null;\r\nconst tokenExpEl = document.getElementById(\"tokenExp\") as HTMLElement | null;\r\nconst closeReset = document.getElementById(\"closeReset\") as HTMLButtonElement | null;\r\n\r\nfunction isPrivileged(role: string) {\r\n  return role === \"admin\" || role === \"owner\";\r\n}\r\nfunction isUserActive(u: any) {\r\n  if (typeof u?.active === \"boolean\") return u.active;\r\n  const st = String(u?.status || \"\").toLowerCase();\r\n  if (!st) return true;\r\n  return st !== \"blocked\";\r\n}\r\nfunction statusBadge(u: any) {\r\n  const st = String(u?.status || (isUserActive(u) ? \"active\" : \"blocked\")).toLowerCase();\r\n  if (st === \"blocked\") return '<span class=\"badge inactive\">Bloqueado</span>';\r\n  return '<span class=\"badge active\">Activo</span>';\r\n}\r\nfunction roleBadge(role: string) {\r\n  return `<span class=\"badge role-${role}\">${escapeHtml(role)}</span>`;\r\n}\r\n\r\nfunction clearFormErrors() {\r\n  if (!emailEl || !roleEl) return;\r\n  [emailEl, roleEl].forEach((el) => {\r\n    el.classList.remove(\"invalid\", \"is-invalid\");\r\n    const label = el.closest(\"label\") || el.parentElement;\r\n    label?.querySelectorAll(\".err-tip\")?.forEach((n) => n.remove());\r\n    el.removeAttribute(\"aria-invalid\");\r\n    el.removeAttribute(\"aria-describedby\");\r\n  });\r\n}\r\n\r\nlet modalOriginal = { email: \"\", role: \"editor\" };\r\n\r\nasync function boot() {\r\n  try {\r\n    me = await clientGetMe();\r\n    canEdit = isPrivileged(String(me?.user?.role || \"\"));\r\n    if (canEdit) newBtn?.removeAttribute(\"disabled\");\r\n    bindEvents();\r\n    await loadUsers();\r\n  } catch (e) {\r\n    toast.show(\"No se pudo cargar usuarios\", \"err\");\r\n    console.error(e);\r\n  }\r\n}\r\n\r\nfunction bindEvents() {\r\n  qEl?.addEventListener(\r\n    \"input\",\r\n    debounce(() => {\r\n      q = (qEl.value || \"\").trim();\r\n      page = 1;\r\n      void loadUsers();\r\n    }, 300)\r\n  );\r\n\r\n  roleFilterEl?.addEventListener(\"change\", () => {\r\n    roleFilter = roleFilterEl.value;\r\n    page = 1;\r\n    void loadUsers();\r\n  });\r\n\r\n  prevBtn?.addEventListener(\"click\", () => {\r\n    if (page > 1) {\r\n      page--;\r\n      void loadUsers();\r\n    }\r\n  });\r\n\r\n  nextBtn?.addEventListener(\"click\", () => {\r\n    const maxPage = Math.max(1, Math.ceil(total / pageSize));\r\n    if (page < maxPage) {\r\n      page++;\r\n      void loadUsers();\r\n    }\r\n  });\r\n\r\n  newBtn?.addEventListener(\"click\", () => openUserModal());\r\n\r\n  cancelUser?.addEventListener(\"click\", () => userModal?.close());\r\n  userForm?.addEventListener(\"submit\", onSubmitUser);\r\n\r\n  userModal?.addEventListener(\"click\", (e) => {\r\n    if (e.target === userModal) userModal.close();\r\n  });\r\n  resetModal?.addEventListener(\"click\", (e) => {\r\n    if (e.target === resetModal) resetModal.close();\r\n  });\r\n\r\n  copyTokenBtn?.addEventListener(\"click\", async () => {\r\n    try {\r\n      if (!resetTokenEl) return;\r\n      await navigator.clipboard.writeText(resetTokenEl.value);\r\n      toast.show(\"Copiado ✅\", \"ok\");\r\n    } catch {\r\n      toast.show(\"No se pudo copiar\", \"err\");\r\n    }\r\n  });\r\n\r\n  closeReset?.addEventListener(\"click\", () => resetModal?.close());\r\n}\r\n\r\nasync function loadUsers() {\r\n  try {\r\n    if (!rowsEl || !pageInfo || !prevBtn || !nextBtn) return;\r\n\r\n    rowsEl.innerHTML = `<tr><td colspan=\"4\" class=\"empty\">Cargando…</td></tr>`;\r\n\r\n    const qs = new URLSearchParams({\r\n      page: String(page),\r\n      pageSize: String(pageSize),\r\n      ...(q ? { q } : {}),\r\n      ...(roleFilter ? { role: roleFilter } : {}),\r\n    }).toString();\r\n\r\n    const res = await apiGet(`/v1/users?${qs}`);\r\n    if (!res.ok) throw new Error(await res.text());\r\n    const data = await res.json();\r\n\r\n    total = data.total || 0;\r\n    items = Array.isArray(data.items) ? data.items : [];\r\n\r\n    if (!items.length) {\r\n      rowsEl.innerHTML = `<tr><td colspan=\"4\" class=\"empty\">Sin resultados</td></tr>`;\r\n    } else {\r\n      rowsEl.innerHTML = items.map((u) => renderRow(u)).join(\"\");\r\n\r\n      rowsEl.querySelectorAll(\"[data-action='edit']\").forEach((btn) =>\r\n        btn.addEventListener(\"click\", () =>\r\n          openUserModal(\r\n            (btn as HTMLElement).dataset.id || null,\r\n            items.find((x) => String(x.id) === String((btn as HTMLElement).dataset.id))\r\n          )\r\n        )\r\n      );\r\n\r\n      rowsEl.querySelectorAll(\".act-block\").forEach((btn) =>\r\n        btn.addEventListener(\"click\", () => onToggleStatus((btn as HTMLElement).dataset.id || \"\", false))\r\n      );\r\n\r\n      rowsEl.querySelectorAll(\".act-unblock\").forEach((btn) =>\r\n        btn.addEventListener(\"click\", () => onToggleStatus((btn as HTMLElement).dataset.id || \"\", true))\r\n      );\r\n\r\n      rowsEl.querySelectorAll(\".act-reset\").forEach((btn) =>\r\n        btn.addEventListener(\"click\", () => onResetToken((btn as HTMLElement).dataset.id || \"\"))\r\n      );\r\n    }\r\n\r\n    const maxPage = Math.max(1, Math.ceil(total / pageSize));\r\n    pageInfo.textContent = `Página ${page} de ${maxPage} • ${total} usuarios`;\r\n\r\n    const prevDisabled = page <= 1;\r\n    const nextDisabled = page >= maxPage;\r\n    prevBtn.disabled = prevDisabled;\r\n    nextBtn.disabled = nextDisabled;\r\n    prevBtn.setAttribute(\"aria-disabled\", String(prevDisabled));\r\n    nextBtn.setAttribute(\"aria-disabled\", String(nextDisabled));\r\n  } catch (e) {\r\n    console.error(e);\r\n    if (rowsEl) rowsEl.innerHTML = `<tr><td colspan=\"4\" class=\"empty\">Error cargando usuarios</td></tr>`;\r\n  }\r\n}\r\n\r\nfunction renderRow(u: any) {\r\n  const active = isUserActive(u);\r\n\r\n  const blockBtn = active\r\n    ? `<button class=\"kbtn danger solid act-block\" data-id=\"${u.id}\">Bloquear</button>`\r\n    : `<button class=\"kbtn success solid act-unblock\" data-id=\"${u.id}\">Desbloquear</button>`;\r\n\r\n  const actions = canEdit\r\n    ? `<div class=\"row-actions\">\r\n        <button class=\"kbtn\" data-action=\"edit\" data-id=\"${u.id}\">Editar</button>\r\n        ${blockBtn}\r\n        <button class=\"kbtn ghost act-reset\" data-id=\"${u.id}\">Blanquear</button>\r\n      </div>`\r\n    : `<span class=\"muted\">—</span>`;\r\n\r\n  return `<tr>\r\n    <td>${escapeHtml(u.email || \"\")}</td>\r\n    <td>${roleBadge(u.role || \"editor\")}</td>\r\n    <td class=\"hidem\">${statusBadge(u)}</td>\r\n    <td class=\"td actions\">${actions}</td>\r\n  </tr>`;\r\n}\r\n\r\nfunction openUserModal(id: string | null = null, data: any = null) {\r\n  if (!userIdEl || !emailEl || !roleEl || !userFormTitle || !userModal) return;\r\n\r\n  clearFormErrors();\r\n  userIdEl.value = id ? String(id) : \"\";\r\n  emailEl.value = data?.email || \"\";\r\n  roleEl.value = data?.role || \"editor\";\r\n\r\n  modalOriginal = { email: emailEl.value, role: String(roleEl.value || \"editor\") };\r\n\r\n  const meId = me?.user?.id ? String(me.user.id) : null;\r\n  const isSelf = meId && id && String(id) === meId;\r\n\r\n  if (isSelf && me?.user?.role !== \"owner\") {\r\n    roleEl.setAttribute(\"disabled\", \"true\");\r\n  } else {\r\n    roleEl.removeAttribute(\"disabled\");\r\n  }\r\n\r\n  userFormTitle.textContent = id ? \"Editar usuario\" : \"Nuevo usuario\";\r\n  if (!canEdit) return;\r\n  userModal.showModal();\r\n}\r\n\r\nasync function onSubmitUser(e: Event) {\r\n  e.preventDefault();\r\n  if (!emailEl || !roleEl || !userIdEl || !userModal) return;\r\n\r\n  clearFormErrors();\r\n\r\n  const id = userIdEl.value || null;\r\n  const email = (emailEl.value || \"\").trim();\r\n  const role = String(roleEl.value || \"editor\");\r\n\r\n  if (!email) {\r\n    markInvalid(emailEl, \"El email es obligatorio\");\r\n    return;\r\n  }\r\n  if (!/^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$/.test(email)) {\r\n    markInvalid(emailEl, \"Email inválido\");\r\n    return;\r\n  }\r\n\r\n  try {\r\n    if (!id) {\r\n      toast.show(\"Creando…\");\r\n      const res = await apiPost(`/v1/users`, { email, role });\r\n      if (!res.ok) {\r\n        const { text, fieldErrors } = await getErrorInfo(res);\r\n        fieldErrors.forEach((fe: any) => {\r\n          const el = fe.field === \"email\" ? emailEl : fe.field === \"role\" ? roleEl : null;\r\n          if (el) markInvalid(el, fe.message || \"Dato inválido\");\r\n        });\r\n        return toast.show(text || \"Error\", \"err\");\r\n      }\r\n      toast.show(\"Creado ✅\", \"ok\");\r\n      userModal.close();\r\n      await loadUsers();\r\n      return;\r\n    }\r\n\r\n    const meId = me?.user?.id ? String(me.user.id) : null;\r\n    const isSelf = meId && String(id) === meId;\r\n\r\n    if (email !== modalOriginal.email) {\r\n      toast.show(\"Actualizando email…\");\r\n      const r = await apiPut(`/v1/users/${id}/email`, { email });\r\n      if (!r.ok) {\r\n        const { text, fieldErrors } = await getErrorInfo(r);\r\n        fieldErrors.forEach((fe: any) => fe.field === \"email\" && markInvalid(emailEl, fe.message || \"Dato inválido\"));\r\n        return toast.show(text || \"No se pudo actualizar el email\", \"err\");\r\n      }\r\n    }\r\n\r\n    if (role !== modalOriginal.role) {\r\n      if (!canEdit) return toast.show(\"No autorizado para cambiar rol\", \"err\");\r\n      if (isSelf && me?.user?.role !== \"owner\") {\r\n        return toast.show(\"No podés cambiar tu propio rol (salvo owner)\", \"err\");\r\n      }\r\n\r\n      toast.show(\"Actualizando rol…\");\r\n      const r = await apiPut(`/v1/users/${id}/role`, { role });\r\n      if (!r.ok) {\r\n        const { text, fieldErrors } = await getErrorInfo(r);\r\n        fieldErrors.forEach((fe: any) => fe.field === \"role\" && markInvalid(roleEl, fe.message || \"Dato inválido\"));\r\n        return toast.show(text || \"No se pudo actualizar el rol\", \"err\");\r\n      }\r\n    }\r\n\r\n    toast.show(\"Guardado ✅\", \"ok\");\r\n    userModal.close();\r\n    await loadUsers();\r\n  } catch (err) {\r\n    console.error(err);\r\n    toast.show(toErrorText(err), \"err\");\r\n  }\r\n}\r\n\r\nasync function onToggleStatus(id: string, nextActive: boolean) {\r\n  if (!canEdit) return toast.show(\"No autorizado\", \"err\");\r\n\r\n  const u = items.find((x) => String(x.id) === String(id));\r\n  if (!u) return;\r\n\r\n  const meId = me?.user?.id ? String(me.user.id) : null;\r\n  const isSelf = meId && String(u.id) === meId;\r\n  if (isSelf) return toast.show(\"No podés bloquearte a vos mismo\", \"err\");\r\n  if (u.role === \"owner\" && nextActive === false) return toast.show(\"No se puede bloquear un Owner\", \"err\");\r\n\r\n  const ok = confirm(`${nextActive ? \"Desbloquear\" : \"Bloquear\"} a ${u.email}?`);\r\n  if (!ok) return;\r\n\r\n  try {\r\n    toast.show(nextActive ? \"Desbloqueando…\" : \"Bloqueando…\");\r\n    const status = nextActive ? \"active\" : \"blocked\";\r\n    const res = await apiPut(`/v1/users/${id}/status`, { status });\r\n    if (!res.ok) {\r\n      const { text } = await getErrorInfo(res);\r\n      return toast.show(text || \"No se pudo actualizar el estado\", \"err\");\r\n    }\r\n    await loadUsers();\r\n    toast.show(\"Estado actualizado ✅\", \"ok\");\r\n  } catch (e) {\r\n    console.error(e);\r\n    toast.show(\"No se pudo actualizar el estado\", \"err\");\r\n  }\r\n}\r\n\r\nasync function onResetToken(id: string) {\r\n  if (!canEdit) return;\r\n  const ok = confirm(\"¿Generar token de blanqueo para este usuario?\");\r\n  if (!ok) return;\r\n\r\n  try {\r\n    toast.show(\"Generando token…\");\r\n    const res = await apiPost(`/v1/users/${id}/recovery-token`);\r\n    if (!res.ok) {\r\n      const { text } = await getErrorInfo(res);\r\n      toast.show(text || \"No se pudo generar el token\", \"err\");\r\n      return;\r\n    }\r\n    const { token, expiresAt } = await res.json();\r\n    if (resetTokenEl) resetTokenEl.value = token || \"\";\r\n    if (tokenExpEl) tokenExpEl.textContent = expiresAt ? \"Vence: \" + new Date(expiresAt).toLocaleString() : \"\";\r\n    resetModal?.showModal();\r\n    toast.clear();\r\n  } catch (e) {\r\n    console.error(e);\r\n    toast.show(\"No se pudo generar el token\", \"err\");\r\n  }\r\n}\r\n\r\nfunction debounce<T extends (...args: any[]) => any>(fn: T, ms = 300) {\r\n  let t: any;\r\n  return (...a: Parameters<T>) => {\r\n    clearTimeout(t);\r\n    t = setTimeout(() => fn(...a), ms);\r\n  };\r\n}\r\n\r\nfunction escapeHtml(str: string) {\r\n  return String(str || \"\").replace(\r\n    /[&<>\"']/g,\r\n    (m) =>\r\n      ({\r\n        \"&\": \"&amp;\",\r\n        \"<\": \"&lt;\",\r\n        \">\": \"&gt;\",\r\n        '\"': \"&quot;\",\r\n        \"'\": \"&#039;\",\r\n      } as any)[m]\r\n  );\r\n}\r\n"],"names":["boot","toast","makeToaster","me","canEdit","page","pageSize","total","q","roleFilter","items","rowsEl","pageInfo","prevBtn","nextBtn","newBtn","qEl","roleFilterEl","userModal","userForm","userFormTitle","userIdEl","emailEl","roleEl","cancelUser","resetModal","resetTokenEl","copyTokenBtn","tokenExpEl","closeReset","isPrivileged","role","isUserActive","u","st","statusBadge","roleBadge","escapeHtml","clearFormErrors","el","label","_a","n","modalOriginal","clientGetMe","bindEvents","loadUsers","e","debounce","maxPage","openUserModal","onSubmitUser","qs","res","apiGet","data","renderRow","btn","x","onToggleStatus","onResetToken","prevDisabled","nextDisabled","blockBtn","actions","id","meId","_b","email","markInvalid","apiPost","text","fieldErrors","getErrorInfo","fe","isSelf","r","apiPut","err","toErrorText","nextActive","status","token","expiresAt","fn","ms","t","a","str","m"],"mappings":"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"}