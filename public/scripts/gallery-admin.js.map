{"version":3,"file":"gallery-admin.js","sources":["../../src/scripts/gallery-admin.ts"],"sourcesContent":["import { apiGet, apiPost, apiDel, getErrorInfo, toErrorText, apiPatch } from \"../lib/api\";\r\n\r\ntype MediaItem = {\r\n  id: number;\r\n  url: string;\r\n  album: string | null;\r\n  estado: \"draft\" | \"published\" | \"archived\";\r\n  alt: string | null;\r\n  description: string | null;\r\n  descripcion?: string | null;\r\n  createdAt?: string;\r\n  updatedAt?: string;\r\n};\r\n\r\ntype CloudinaryUploadInfo = {\r\n  public_id?: string;\r\n  resource_type?: string;\r\n  secure_url?: string;\r\n};\r\n\r\nfunction escapeHtml(str: string) {\r\n  return (str || \"\").replace(/[&<>\"']/g, (m) => ({ \"&\": \"&amp;\", \"<\": \"&lt;\", \">\": \"&gt;\", '\"': \"&quot;\", \"'\": \"&#039;\" }[m]!));\r\n}\r\n\r\nfunction slugify(s: string) {\r\n  return s\r\n    .normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\")\r\n    .replace(/[^a-zA-Z0-9]+/g, \"-\")\r\n    .replace(/^-+|-+$/g, \"\")\r\n    .toLowerCase();\r\n}\r\n\r\nfunction fmtDate(iso?: string) {\r\n  if (!iso) return \"\";\r\n  const d = new Date(iso);\r\n  if (Number.isNaN(+d)) return iso;\r\n  return d.toLocaleString(\"es-AR\", {\r\n    year: \"numeric\",\r\n    month: \"short\",\r\n    day: \"2-digit\",\r\n    hour: \"2-digit\",\r\n    minute: \"2-digit\",\r\n  });\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  const cfg = document.getElementById(\"cfg-media\") as HTMLDivElement | null;\r\n  const DEFAULT_FOLDER = cfg?.dataset.folder || \"gallery\";\r\n  const RESOURCE_TYPE = cfg?.dataset.resourceType || \"image\";\r\n\r\n  const cardsEl = document.getElementById(\"cards\") as HTMLDivElement;\r\n  const statusEl = document.getElementById(\"status\") as HTMLDivElement;\r\n\r\n  const btnNew = document.getElementById(\"btn-new\") as HTMLButtonElement;\r\n  const btnReload = document.getElementById(\"btn-reload\") as HTMLButtonElement;\r\n  const btnMore = document.getElementById(\"btn-load-more\") as HTMLButtonElement;\r\n\r\n  const qEl = document.getElementById(\"q\") as HTMLInputElement;\r\n  const fStatusEl = document.getElementById(\"f-status\") as HTMLSelectElement;\r\n  const fAlbumEl = document.getElementById(\"f-album\") as HTMLInputElement;\r\n\r\n  const dlgEdit = document.getElementById(\"dlg-edit\") as HTMLDialogElement;\r\n  const formEdit = document.getElementById(\"form-edit\") as HTMLFormElement;\r\n  const dlgTitle = document.getElementById(\"dlg-title\") as HTMLHeadingElement;\r\n\r\n  const fileEl = document.getElementById(\"file\") as HTMLInputElement;\r\n  const urlEl = document.getElementById(\"url\") as HTMLInputElement;\r\n  const albumEl = document.getElementById(\"album\") as HTMLInputElement;\r\n  const estadoEl = document.getElementById(\"estado\") as HTMLSelectElement;\r\n  const altEl = document.getElementById(\"alt\") as HTMLInputElement;\r\n  const descEl = document.getElementById(\"descripcion\") as HTMLTextAreaElement;\r\n\r\n  const btnUpload = document.getElementById(\"btn-upload\") as HTMLButtonElement;\r\n  const btnCancel = document.getElementById(\"btn-cancel\") as HTMLButtonElement;\r\n\r\n  const dlgView = document.getElementById(\"dlg-view\") as HTMLDialogElement;\r\n  const viewBody = document.getElementById(\"view-body\") as HTMLDivElement;\r\n  const btnCloseV = document.getElementById(\"btn-close-view\") as HTMLButtonElement;\r\n\r\n  const dlgDel = document.getElementById(\"dlg-del\") as HTMLDialogElement;\r\n  const delMsg = document.getElementById(\"del-msg\") as HTMLParagraphElement;\r\n  const btnCancelDel = document.getElementById(\"btn-cancel-del\") as HTMLButtonElement;\r\n  const btnConfirmDel = document.getElementById(\"btn-confirm-del\") as HTMLButtonElement;\r\n\r\n  const uploadBlock = document.getElementById(\"upload-block\") as HTMLDivElement;\r\n  const editNote = document.getElementById(\"edit-note\") as HTMLElement;\r\n\r\n  let editingId: number | null = null;\r\n  let page = 1;\r\n  let hasMore = false;\r\n  let lastUpload: CloudinaryUploadInfo | null = null;\r\n\r\n  function toast(msg: string, type: \"\" | \"ok\" | \"err\" = \"\") {\r\n    if (!statusEl) return;\r\n    statusEl.textContent = msg;\r\n    statusEl.className = `status show ${type}`;\r\n    if (type === \"ok\") setTimeout(() => (statusEl.className = \"status\"), 1600);\r\n  }\r\n\r\n  async function requestSignature(payload: {\r\n    resourceType: string;\r\n    folder?: string;\r\n    publicId?: string;\r\n    incomingTransform?: string;\r\n  }) {\r\n    const res = await apiPost(\"/v1/media/sign\", payload);\r\n    if (!res.ok) throw new Error(\"No se pudo obtener la firma\");\r\n    return res.json();\r\n  }\r\n\r\n  async function uploadToCloudinary(file: File, sig: any) {\r\n    const resourceType = sig.resourceType || \"image\";\r\n    const url = `https://api.cloudinary.com/v1_1/${sig.cloudName}/${resourceType}/upload`;\r\n    const form = new FormData();\r\n    form.append(\"file\", file);\r\n    form.append(\"api_key\", String(sig.apiKey));\r\n    form.append(\"timestamp\", String(sig.timestamp));\r\n    form.append(\"signature\", String(sig.signature));\r\n    if (sig.folder)         form.append(\"folder\", sig.folder);\r\n    if (sig.publicId)       form.append(\"public_id\", sig.publicId);\r\n    if (sig.transformation) form.append(\"transformation\", sig.transformation);\r\n\r\n    const r = await fetch(url, { method: \"POST\", body: form });\r\n    if (!r.ok) throw new Error(`Error subiendo a Cloudinary (${r.status})`);\r\n    return r.json();\r\n  }\r\n\r\n  function renderCard(m: MediaItem) {\r\n    const album  = m.album ?? \"—\";\r\n    const estado = m.estado ?? \"draft\";\r\n    const alt    = m.alt ?? \"\";\r\n    const desc   = m.description ?? m.descripcion ?? \"\";\r\n\r\n    return `\r\n      <div class=\"card clickable\" role=\"button\" tabindex=\"0\" data-id=\"${m.id}\">\r\n        <div class=\"thumb\">${m.url ? `<img src=\"${m.url}\" alt=\"${escapeHtml(alt)}\">` : \"Sin imagen\"}</div>\r\n        <div class=\"body\">\r\n          <div class=\"chips\">\r\n            <span class=\"chip\">Álbum: ${escapeHtml(album)}</span>\r\n            <span class=\"chip\">Estado: ${escapeHtml(\r\n              estado === \"published\" ? \"Publicado\" : estado === \"draft\" ? \"Borrador\" : \"Archivado\"\r\n            )}</span>\r\n          </div>\r\n          ${desc ? `<div style=\"font-size:.9rem;color:var(--muted)\">${escapeHtml(desc)}</div>` : \"\"}\r\n          <div class=\"row\" style=\"margin-top:.6rem\">\r\n            <button class=\"btn\" data-act=\"edit\">Editar</button>\r\n            <div class=\"grow\"></div>\r\n            <button class=\"btn\" data-act=\"del\">Eliminar</button>\r\n          </div>\r\n        </div>\r\n      </div>`;\r\n  }\r\n\r\n  async function load(reset = true) {\r\n    if (reset) { page = 1; cardsEl.innerHTML = \"\"; }\r\n\r\n    const params = new URLSearchParams();\r\n    if (qEl.value.trim()) params.set(\"q\", qEl.value.trim());\r\n    if (fStatusEl.value) params.set(\"estado\", fStatusEl.value);\r\n    if (fAlbumEl.value.trim()) params.set(\"album\", fAlbumEl.value.trim());\r\n    params.set(\"page\", String(page));\r\n    params.set(\"limit\", \"24\");\r\n\r\n    const res = await apiGet(`/v1/media/gallery/assets?${params.toString()}`);\r\n    if (!res.ok) {\r\n      const { text } = await getErrorInfo(res);\r\n      toast(text, \"err\");\r\n      return;\r\n    }\r\n\r\n    const j = await res.json();\r\n    const items: MediaItem[] = j.items ?? j.data ?? j.results ?? [];\r\n    hasMore = !!j.hasMore || (Array.isArray(items) && items.length === 24);\r\n    btnMore.hidden = !hasMore;\r\n\r\n    for (const m of items) cardsEl.insertAdjacentHTML(\"beforeend\", renderCard(m));\r\n  }\r\n\r\n  function setEditMode(isEdit: boolean) {\r\n    if (isEdit) {\r\n      uploadBlock.hidden = true;\r\n      editNote.hidden = false;\r\n      fileEl.disabled = true;\r\n      urlEl.disabled = true;\r\n      btnUpload.disabled = true;\r\n      btnUpload.hidden = true;\r\n    } else {\r\n      uploadBlock.hidden = false;\r\n      editNote.hidden = true;\r\n      fileEl.disabled = false;\r\n      urlEl.disabled = false;\r\n      btnUpload.disabled = false;\r\n      btnUpload.hidden = false;\r\n    }\r\n  }\r\n\r\n  function fillEditForm(m?: MediaItem) {\r\n    urlEl.value    = m?.url ?? \"\";\r\n    albumEl.value  = m?.album ?? \"\";\r\n    estadoEl.value = (m?.estado ?? \"draft\") as any;\r\n    altEl.value    = m?.alt ?? \"\";\r\n    descEl.value   = m?.description ?? m?.descripcion ?? \"\";\r\n    fileEl.value   = \"\";\r\n    lastUpload = null;\r\n  }\r\n\r\n  async function openEdit(id: number | null) {\r\n    editingId = id;\r\n    dlgTitle.textContent = id ? \"Editar imagen\" : \"Nueva imagen\";\r\n\r\n    if (id) {\r\n      setEditMode(true);\r\n      const res = await apiGet(`/v1/media/gallery/assets/${id}`);\r\n      if (!res.ok) { toast((await getErrorInfo(res)).text, \"err\"); return; }\r\n      const m: MediaItem = await res.json();\r\n      fillEditForm(m);\r\n    } else {\r\n      setEditMode(false);\r\n      fillEditForm(undefined);\r\n    }\r\n\r\n    (dlgEdit as any).showModal();\r\n  }\r\n\r\n  async function openView(id: number) {\r\n    const res = await apiGet(`/v1/media/gallery/assets/${id}`);\r\n    if (!res.ok) { toast((await getErrorInfo(res)).text, \"err\"); return; }\r\n    const m: MediaItem = await res.json();\r\n\r\n    const album  = m.album ?? \"—\";\r\n    const estado = m.estado ?? \"draft\";\r\n    const alt    = m.alt ?? \"\";\r\n    const desc   = m.description ?? m.descripcion ?? \"\";\r\n\r\n    viewBody.innerHTML = `\r\n      <div style=\"height:240px; background:#fafafa; border:1px solid var(--border); border-radius:12px; overflow:hidden; margin-bottom:.75rem;\">\r\n        ${m.url ? `<img src=\"${m.url}\" alt=\"${escapeHtml(alt)}\" style=\"width:100%;height:100%;object-fit:contain;background:#fff\">` : \"\"}\r\n      </div>\r\n      <div class=\"view-kv\"><div class=\"k\">Álbum</div><div class=\"v\">${escapeHtml(album)}</div></div>\r\n      <div class=\"view-kv\"><div class=\"k\">Estado</div><div class=\"v\">${escapeHtml(\r\n        estado === \"published\" ? \"Publicado\" : estado === \"draft\" ? \"Borrador\" : \"Archivado\"\r\n      )}</div></div>\r\n      <div class=\"view-kv\"><div class=\"k\">Texto alternativo</div><div class=\"v\">${escapeHtml(alt)}</div></div>\r\n      <div class=\"view-kv\"><div class=\"k\">Descripción</div><div class=\"v\">${escapeHtml(desc)}</div></div>\r\n      <div class=\"view-kv\"><div class=\"k\">Creación</div><div class=\"v\">${escapeHtml(fmtDate(m.createdAt))}</div></div>\r\n      <div class=\"view-kv\"><div class=\"k\">Actualización</div><div class=\"v\">${escapeHtml(fmtDate(m.updatedAt))}</div></div>\r\n    `;\r\n    (dlgView as any).showModal();\r\n  }\r\n\r\n  function highlightFieldErrors(list: { field: string; message?: string }[]) {\r\n    const map: Record<string, HTMLElement | null> = {\r\n      album: albumEl,\r\n      estado: estadoEl,\r\n      alt: altEl,\r\n      description: descEl,\r\n      descripcion: descEl,\r\n      url: urlEl,\r\n    };\r\n    list.forEach(({ field }) => {\r\n      const el = map[field];\r\n      el?.classList.add(\"invalid\");\r\n      setTimeout(() => el?.classList.remove(\"invalid\"), 1800);\r\n    });\r\n  }\r\n\r\n  btnNew?.addEventListener(\"click\", () => openEdit(null));\r\n  btnReload?.addEventListener(\"click\", () => load(true));\r\n  btnMore?.addEventListener(\"click\", () => { page += 1; load(false); });\r\n\r\n  cardsEl.addEventListener(\"click\", (e) => {\r\n    const target = e.target as HTMLElement;\r\n    const btn = target.closest(\"button\");\r\n    const card = target.closest(\".card\") as HTMLElement | null;\r\n    if (!card) return;\r\n    const id = Number(card.dataset.id);\r\n\r\n    if (btn) {\r\n      const act = btn.dataset.act;\r\n      if (act === \"edit\") openEdit(id);\r\n      else if (act === \"del\") confirmDelete(id, false);\r\n      return;\r\n    }\r\n\r\n    openView(id);\r\n  });\r\n\r\n  cardsEl.addEventListener(\"keydown\", (e) => {\r\n    const target = e.target as HTMLElement;\r\n    if (!target.classList.contains(\"card\")) return;\r\n    if (e.key === \"Enter\" || e.key === \" \") {\r\n      e.preventDefault();\r\n      const id = Number(target.dataset.id);\r\n      openView(id);\r\n    }\r\n  });\r\n\r\n  btnCancel?.addEventListener(\"click\", () => {\r\n    dlgEdit.close();\r\n    lastUpload = null;\r\n    setEditMode(false);\r\n  });\r\n\r\n  btnUpload?.addEventListener(\"click\", async () => {\r\n    if (editingId) { toast(\"En edición no se puede cambiar la imagen.\", \"err\"); return; }\r\n    const file = fileEl.files?.[0];\r\n    if (!file) { toast(\"Seleccioná un archivo\", \"err\"); return; }\r\n    if (!/^image\\//.test(file.type)) { toast(\"Formato no soportado\", \"err\"); return; }\r\n    if (file.size > 10 * 1024 * 1024) { toast(\"La imagen supera 10MB\", \"err\"); return; }\r\n\r\n    try {\r\n      toast(\"Subiendo imagen…\");\r\n      const album = albumEl.value.trim();\r\n      const folder = album ? `${DEFAULT_FOLDER}/${slugify(album)}` : DEFAULT_FOLDER;\r\n\r\n      const sig = await requestSignature({\r\n        resourceType: RESOURCE_TYPE,\r\n        folder,\r\n        incomingTransform: \"c_limit,w_2560/f_webp,q_auto:good\",\r\n      });\r\n\r\n      const r = await uploadToCloudinary(file, sig);\r\n      lastUpload = { public_id: r.public_id, resource_type: r.resource_type, secure_url: r.secure_url };\r\n      urlEl.value = r.secure_url;\r\n      toast(\"Imagen subida ✅\", \"ok\");\r\n    } catch (e) {\r\n      console.error(e);\r\n      toast(\"No se pudo subir la imagen\", \"err\");\r\n    }\r\n  });\r\n\r\n  formEdit?.addEventListener(\"submit\", async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      if (editingId) {\r\n        const body = {\r\n          alt: (altEl.value ?? \"\"),\r\n          description: (descEl.value ?? \"\"),\r\n          album: (albumEl.value ?? \"\"),\r\n          estado: estadoEl.value as MediaItem[\"estado\"],\r\n        };\r\n        const res = await apiPatch(`/v1/media/gallery/assets/${editingId}`, body);\r\n        if (!res.ok) {\r\n          const { text, fieldErrors } = await getErrorInfo(res);\r\n          if (fieldErrors.length) highlightFieldErrors(fieldErrors);\r\n          throw new Error(text);\r\n        }\r\n      } else {\r\n        const meta = {\r\n          alt: (altEl.value || \"\").trim() || null,\r\n          description: (descEl.value || \"\").trim() || null,\r\n          album: (albumEl.value || \"\").trim() || null,\r\n          estado: estadoEl.value as MediaItem[\"estado\"],\r\n        };\r\n\r\n        const upload: CloudinaryUploadInfo = {};\r\n        if (lastUpload?.secure_url) upload.secure_url = lastUpload.secure_url;\r\n        if (lastUpload?.public_id) upload.public_id = lastUpload.public_id;\r\n        if (lastUpload?.resource_type) upload.resource_type = lastUpload.resource_type;\r\n        if (!upload.secure_url && urlEl.value.trim()) upload.secure_url = urlEl.value.trim();\r\n        if (!upload.secure_url) throw new Error(\"Subí una imagen o pegá una URL.\");\r\n\r\n        const body: any = { items: [{ upload, meta }] };\r\n\r\n        const res = await apiPost(`/v1/media/gallery/assets`, body);\r\n        if (!res.ok) {\r\n          const { text, fieldErrors } = await getErrorInfo(res);\r\n          if (fieldErrors.length) highlightFieldErrors(fieldErrors);\r\n          throw new Error(text);\r\n        }\r\n      }\r\n\r\n      dlgEdit.close();\r\n      lastUpload = null;\r\n      toast(\"Guardado ✅\", \"ok\");\r\n      await load(true);\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast(toErrorText(err), \"err\");\r\n    }\r\n  });\r\n\r\n  btnCloseV?.addEventListener(\"click\", () => dlgView.close());\r\n\r\n  let deletingId: number | null = null;\r\n\r\n  function confirmDelete(id: number, force: boolean) {\r\n    deletingId = id;\r\n    delMsg.textContent = force\r\n      ? \"La imagen está publicada. ¿Eliminar de todos modos?\"\r\n      : \"¿Seguro que querés eliminar esta imagen?\";\r\n\r\n    (dlgDel as any).showModal();\r\n\r\n    btnConfirmDel.onclick = async () => {\r\n      try {\r\n        const url = force ? `/v1/media/gallery/assets/${id}?force=true` : `/v1/media/gallery/assets/${id}`;\r\n        const res = await apiDel(url);\r\n\r\n        if (res.status === 409 && !force) {\r\n          dlgDel.close();\r\n          confirmDelete(id, true);\r\n          return;\r\n        }\r\n        if (!res.ok) {\r\n          const { text } = await getErrorInfo(res);\r\n          throw new Error(text);\r\n        }\r\n        dlgDel.close();\r\n        toast(\"Eliminado ✅\", \"ok\");\r\n        await load(true);\r\n      } catch (e) {\r\n        console.error(e);\r\n        dlgDel.close();\r\n        toast(toErrorText(e), \"err\");\r\n      }\r\n    };\r\n  }\r\n\r\n  btnCancelDel?.addEventListener(\"click\", () => dlgDel.close());\r\n\r\n  load(true);\r\n});\r\n"],"names":["escapeHtml","str","m","slugify","s","fmtDate","iso","d","cfg","DEFAULT_FOLDER","RESOURCE_TYPE","cardsEl","statusEl","btnNew","btnReload","btnMore","qEl","fStatusEl","fAlbumEl","dlgEdit","formEdit","dlgTitle","fileEl","urlEl","albumEl","estadoEl","altEl","descEl","btnUpload","btnCancel","dlgView","viewBody","btnCloseV","dlgDel","delMsg","btnCancelDel","btnConfirmDel","uploadBlock","editNote","editingId","page","hasMore","lastUpload","toast","msg","type","requestSignature","payload","res","apiPost","uploadToCloudinary","file","sig","resourceType","url","form","r","renderCard","album","estado","alt","desc","load","reset","params","apiGet","text","getErrorInfo","j","items","setEditMode","isEdit","fillEditForm","openEdit","id","openView","highlightFieldErrors","list","map","field","el","target","btn","card","act","confirmDelete","_a","folder","e","body","apiPatch","fieldErrors","meta","upload","err","toErrorText","deletingId","force","apiDel"],"mappings":"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"}