{"version":3,"file":"content-editor.js","sources":["../../src/scripts/content-editor.ts"],"sourcesContent":["import EditorJS, { type ToolConstructable } from \"@editorjs/editorjs\";\r\nimport Header from \"@editorjs/header\";\r\nimport List from \"@editorjs/list\";\r\nimport ImageTool from \"@editorjs/image\";\r\n\r\nimport { apiPost, getErrorInfo, toErrorText } from \"../lib/api\";\r\nimport {\r\n  requestSignature,\r\n  uploadToCloudinary,\r\n  assertImage,\r\n  markInvalid,\r\n  clearFieldError,\r\n  clearFileInput,\r\n} from \"../lib/admin-uploader\";\r\n\r\nconst HeaderTool: ToolConstructable = Header as unknown as ToolConstructable;\r\nconst ListTool: ToolConstructable = List as unknown as ToolConstructable;\r\nconst ImageToolC: ToolConstructable = ImageTool as unknown as ToolConstructable;\r\n\r\nconst CONTENT_KEY = \"cms:contenido:draft\";\r\nconst META_KEY = \"cms:postmeta:draft:new\";\r\n\r\nfunction getEl<T extends HTMLElement>(id: string) {\r\n  const el = document.getElementById(id) as T | null;\r\n  if (!el) throw new Error(`No se encontró #${id}`);\r\n  return el;\r\n}\r\n\r\nfunction isValidUrl(str: string) {\r\n  if (!str) return false;\r\n  try {\r\n    new URL(str);\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * IMPORTANTE:\r\n * - Si msg es vacío, limpiamos el status (sin .show)\r\n * - Si type === \"ok\", autocierra\r\n */\r\nfunction showStatus(msg: string, type: \"\" | \"ok\" | \"err\" = \"\") {\r\n  const statusEl = document.getElementById(\"status\");\r\n  if (!statusEl) return;\r\n\r\n  if (!msg) {\r\n    statusEl.textContent = \"\";\r\n    statusEl.className = \"status\";\r\n    return;\r\n  }\r\n\r\n  statusEl.textContent = msg;\r\n  statusEl.className = `status show ${type}`;\r\n  if (type === \"ok\") setTimeout(() => (statusEl.className = \"status\"), 1600);\r\n}\r\n\r\nfunction clearFieldErrors() {\r\n  document.querySelectorAll(\".invalid\").forEach((el) => el.classList.remove(\"invalid\", \"is-invalid\"));\r\n  document.querySelectorAll(\".err-tip\").forEach((el) => el.remove());\r\n}\r\n\r\nfunction toHumanLabel(field: string) {\r\n  const map: Record<string, string> = {\r\n    titulo: \"Título\",\r\n    excerpt: \"Resumen\",\r\n    portadaUrl: \"URL de la portada\",\r\n    destacado: \"Destacado\",\r\n    linkUrl: \"Enlace\",\r\n    tipo: \"Tipo\",\r\n    blocksJson: \"Contenido\",\r\n  };\r\n  return map[field] || field;\r\n}\r\n\r\nfunction markFieldErrors(fieldErrors: { field: string; message: string }[]) {\r\n  clearFieldErrors();\r\n\r\n  for (const { field, message } of fieldErrors) {\r\n    const el =\r\n      (field === \"titulo\" && document.getElementById(\"titulo\")) ||\r\n      (field === \"excerpt\" && document.getElementById(\"excerpt\")) ||\r\n      (field === \"portadaUrl\" && document.getElementById(\"portadaUrl\")) ||\r\n      (field === \"destacado\" && document.getElementById(\"destacado\")) ||\r\n      (field === \"linkUrl\" && document.getElementById(\"linkUrl\")) ||\r\n      (field === \"tipo\" && document.getElementById(\"tipo\")) ||\r\n      null;\r\n\r\n    if (el) markInvalid(el, `${toHumanLabel(field)}: ${message || \"Dato inválido\"}`);\r\n  }\r\n}\r\n\r\nfunction escapeHtml(str: string) {\r\n  return str.replace(/[&<>\"']/g, (m) => ({ \"&\": \"&amp;\", \"<\": \"&lt;\", \">\": \"&gt;\", '\"': \"&quot;\", \"'\": \"&#039;\" }[m]!));\r\n}\r\n\r\ntype MetaDraft = {\r\n  tipo: \"noticia\" | \"novedad\";\r\n  titulo: string;\r\n  excerpt: string;\r\n  portadaUrl: string;\r\n  destacado: boolean;\r\n  linkUrl: string | null;\r\n};\r\n\r\nlet dirty = false;\r\nlet metaTimer: number | null = null;\r\n\r\nfunction markDirty() {\r\n  dirty = true;\r\n  if (metaTimer) window.clearTimeout(metaTimer);\r\n  metaTimer = window.setTimeout(saveMeta, 600);\r\n}\r\n\r\nfunction saveMeta() {\r\n  metaTimer = null;\r\n\r\n  const tipoEl = document.getElementById(\"tipo\") as HTMLInputElement | null;\r\n  const tituloEl = document.getElementById(\"titulo\") as HTMLInputElement | null;\r\n  const excerptEl = document.getElementById(\"excerpt\") as HTMLTextAreaElement | null;\r\n  const portadaEl = document.getElementById(\"portadaUrl\") as HTMLInputElement | null;\r\n  const destacadoEl = document.getElementById(\"destacado\") as HTMLInputElement | null;\r\n  const linkUrlEl = document.getElementById(\"linkUrl\") as HTMLInputElement | null;\r\n\r\n  const meta: MetaDraft = {\r\n    tipo: tipoEl?.value === \"novedad\" ? \"novedad\" : \"noticia\",\r\n    titulo: (tituloEl?.value || \"\").trim(),\r\n    excerpt: (excerptEl?.value || \"\").trim(),\r\n    portadaUrl: (portadaEl?.value || \"\").trim(),\r\n    destacado: !!destacadoEl?.checked,\r\n    linkUrl: tipoEl?.value === \"novedad\" ? ((linkUrlEl?.value || \"\").trim() || null) : null,\r\n  };\r\n\r\n  localStorage.setItem(META_KEY, JSON.stringify(meta));\r\n}\r\n\r\nfunction loadMeta(): MetaDraft | null {\r\n  const raw = localStorage.getItem(META_KEY);\r\n  if (!raw) return null;\r\n  try {\r\n    return JSON.parse(raw) as MetaDraft;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction bindUnsavedChangesGuard() {\r\n  window.addEventListener(\"beforeunload\", (e) => {\r\n    if (!dirty) return;\r\n    e.preventDefault();\r\n    e.returnValue = \"\";\r\n  });\r\n}\r\n\r\nasync function boot() {\r\n  const holder = getEl<HTMLDivElement>(\"editorjs\");\r\n\r\n  // IMPORTANTE: esta config viene del DOM (nueva.astro / editar.astro)\r\n  const DEFAULT_FOLDER = holder.dataset.folder || \"pages\";\r\n  const rawType = holder.dataset.resourceType;\r\n  const RESOURCE_TYPE: \"image\" | \"video\" = rawType === \"video\" ? \"video\" : \"image\";\r\n\r\n  const saveBtn = document.getElementById(\"saveBtn\");\r\n  const previewBtn = document.getElementById(\"previewBtn\");\r\n\r\n  const tipoEl = document.getElementById(\"tipo\") as HTMLInputElement | null;\r\n  const tituloEl = document.getElementById(\"titulo\") as HTMLInputElement | null;\r\n  const excerptEl = document.getElementById(\"excerpt\") as HTMLTextAreaElement | null;\r\n  const portadaEl = document.getElementById(\"portadaUrl\") as HTMLInputElement | null;\r\n  const portadaFileEl = document.getElementById(\"portadaFile\") as HTMLInputElement | null;\r\n  const destacadoEl = document.getElementById(\"destacado\") as HTMLInputElement | null;\r\n  const linkUrlEl = document.getElementById(\"linkUrl\") as HTMLInputElement | null;\r\n\r\n  // ---- Guardar meta / limpiar errores en inputs (UN SOLO SET DE LISTENERS) ----\r\n  [tipoEl, tituloEl, excerptEl, portadaEl, destacadoEl, linkUrlEl].forEach((el) => {\r\n    if (!el) return;\r\n    const handler = () => {\r\n      clearFieldError(el as HTMLElement);\r\n      markDirty();\r\n    };\r\n    el.addEventListener(\"input\", handler);\r\n    el.addEventListener(\"change\", handler);\r\n  });\r\n\r\n  // ---- Portada upload ----\r\n  portadaFileEl?.addEventListener(\"change\", async (e) => {\r\n    const input = e.currentTarget as HTMLInputElement | null;\r\n    const file = input?.files?.[0];\r\n    if (!file || !portadaEl) return;\r\n\r\n    try {\r\n      assertImage(file, 10);\r\n    } catch (err: any) {\r\n      markInvalid(portadaFileEl, err?.message || \"Archivo inválido\");\r\n      clearFileInput(portadaFileEl);\r\n      showStatus(err?.message || \"Archivo inválido\", \"err\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      showStatus(\"Subiendo portada…\");\r\n\r\n      const sig = await requestSignature({\r\n        resourceType: RESOURCE_TYPE,\r\n        folder: `${DEFAULT_FOLDER}/portadas`,\r\n        incomingTransform: \"c_limit,w_2560/f_webp,q_auto:good\",\r\n      });\r\n\r\n      const resp = await uploadToCloudinary(file, sig);\r\n      portadaEl.value = resp.secure_url;\r\n\r\n      clearFieldError(portadaFileEl);\r\n      clearFileInput(portadaFileEl);\r\n\r\n      showStatus(\"Imagen subida ✅\", \"ok\");\r\n      markDirty();\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      markInvalid(portadaFileEl, err?.message || \"No se pudo subir la imagen\");\r\n      clearFileInput(portadaFileEl);\r\n      showStatus(err?.message || \"No se pudo subir la imagen\", \"err\");\r\n    }\r\n  });\r\n\r\n  // ---- Cargar draft meta ----\r\n  const metaDraft = loadMeta();\r\n  if (metaDraft) {\r\n    if (tipoEl) tipoEl.value = metaDraft.tipo;\r\n    if (tituloEl) tituloEl.value = metaDraft.titulo || \"\";\r\n    if (excerptEl) excerptEl.value = metaDraft.excerpt || \"\";\r\n    if (portadaEl) portadaEl.value = metaDraft.portadaUrl || \"\";\r\n    if (destacadoEl) destacadoEl.checked = !!metaDraft.destacado;\r\n    if (linkUrlEl && metaDraft.tipo === \"novedad\") linkUrlEl.value = metaDraft.linkUrl || \"\";\r\n    dirty = true;\r\n  }\r\n\r\n  // ---- EditorJS Image tool ----\r\n  const imageToolConfig = {\r\n    class: ImageToolC,\r\n    config: {\r\n      captionPlaceholder: \"Pie de imagen\",\r\n      uploader: {\r\n        async uploadByFile(file: File) {\r\n          assertImage(file, 10);\r\n\r\n          showStatus(\"Subiendo imagen…\");\r\n\r\n          const sig = await requestSignature({\r\n            resourceType: RESOURCE_TYPE,\r\n            folder: DEFAULT_FOLDER,\r\n            incomingTransform: \"c_limit,w_2560/f_webp,q_auto:good\",\r\n          });\r\n\r\n          const resp = await uploadToCloudinary(file, sig);\r\n\r\n          showStatus(\"\", \"\");\r\n          return { success: 1, file: { url: resp.secure_url } };\r\n        },\r\n      },\r\n    },\r\n  } as any;\r\n\r\n  const editor = new EditorJS({\r\n    holder: \"editorjs\",\r\n    autofocus: true,\r\n    placeholder: \"Escribí acá…\",\r\n    i18n: {\r\n      messages: {\r\n        ui: {\r\n          toolbar: { toolbox: { Add: \"Añadir bloque\", Filter: \"Buscar\", \"Nothing found\": \"Sin resultados\" }, converter: { \"Convert to\": \"Convertir a\" } },\r\n          blockTunes: { toggler: { \"Click to tune\": \"Ajustes\", \"or move\": \"o mover\" } },\r\n          popover: { Filter: \"Buscar\", \"Nothing found\": \"Sin resultados\", \"Convert to\": \"Convertir a\" },\r\n        },\r\n        toolNames: {\r\n          Paragraph: \"Párrafo\",\r\n          Text: \"Párrafo\",\r\n          Header: \"Título\",\r\n          Heading: \"Título\",\r\n          Image: \"Imagen\",\r\n          Checklist: \"Lista de tareas\",\r\n          \"Unordered List\": \"Lista con viñetas\",\r\n          \"Ordered List\": \"Lista numerada\",\r\n          \"Unordered list\": \"Lista con viñetas\",\r\n          \"Ordered list\": \"Lista numerada\",\r\n          Warning: \"Advertencia\",\r\n          Quote: \"Cita\",\r\n          Italic: \"Itálica\",\r\n          Bold: \"Negrita\",\r\n        },\r\n        blockTunes: {\r\n          delete: { Delete: \"Eliminar\", \"Click to delete\": \"Click para confirmar\" },\r\n          moveUp: { \"Move up\": \"Mover arriba\" },\r\n          moveDown: { \"Move down\": \"Mover abajo\" },\r\n        },\r\n        tools: {\r\n          list: { Ordered: \"Numerada\", Unordered: \"Viñetas\" },\r\n          image: {\r\n            Caption: \"Pie de imagen\",\r\n            \"Select an Image\": \"Seleccionar imagen\",\r\n            \"With border\": \"Con borde\",\r\n            \"Stretch image\": \"Estirar imagen\",\r\n            \"With background\": \"Con fondo\",\r\n          },\r\n          header: { Heading: \"Título\", \"Heading 2\": \"Título 2\", \"Heading 3\": \"Título 3\", \"Heading 4\": \"Título 4\" },\r\n          checklist: { Checklist: \"Lista de tareas\", \"Add an item\": \"Agregar ítem\" },\r\n          link: { \"Add a link\": \"Añadir un enlace\" },\r\n        },\r\n      },\r\n    },\r\n    tools: {\r\n      header: {\r\n        class: HeaderTool,\r\n        inlineToolbar: true,\r\n        toolbox: { title: \"Título\" },\r\n        config: { levels: [2, 3, 4], defaultLevel: 2 },\r\n      } as any,\r\n      list: {\r\n        class: ListTool,\r\n        inlineToolbar: true,\r\n        toolbox: { title: \"Lista\" },\r\n      } as any,\r\n      image: imageToolConfig,\r\n    },\r\n    data: JSON.parse(\r\n      localStorage.getItem(CONTENT_KEY) ||\r\n        '{\"time\":0,\"blocks\":[{\"type\":\"paragraph\",\"data\":{\"text\":\"\"}}],\"version\":\"2.29.0\"}'\r\n    ),\r\n    onChange: async () => {\r\n      try {\r\n        const out = await editor.save();\r\n        localStorage.setItem(CONTENT_KEY, JSON.stringify(out));\r\n        dirty = true;\r\n      } catch {}\r\n    },\r\n  });\r\n\r\n  bindUnsavedChangesGuard();\r\n\r\n  saveBtn?.addEventListener(\"click\", async () => {\r\n    try {\r\n      showStatus(\"Guardando…\");\r\n\r\n      const blocks = JSON.parse(localStorage.getItem(CONTENT_KEY) || \"null\") || (await editor.save());\r\n\r\n      const tipo = tipoEl?.value === \"novedad\" ? \"novedad\" : \"noticia\";\r\n      const titulo = (tituloEl?.value ?? \"\").trim();\r\n      const excerpt = (excerptEl?.value ?? \"\").trim();\r\n      const portada = (portadaEl?.value ?? \"\").trim();\r\n      const destacado = tipo === \"novedad\" ? true : !!destacadoEl?.checked;\r\n      const linkUrl = tipo === \"novedad\" ? (linkUrlEl?.value ?? \"\").trim() : \"\";\r\n\r\n      clearFieldErrors();\r\n\r\n      if (!titulo) {\r\n        markInvalid(tituloEl, \"El título es obligatorio\");\r\n        showStatus(\"Falta el título\", \"err\");\r\n        return;\r\n      }\r\n\r\n      if (portada && !isValidUrl(portada)) {\r\n        markInvalid(portadaEl, \"URL de portada inválida\");\r\n        showStatus(\"URL inválida: Portada\", \"err\");\r\n        return;\r\n      }\r\n\r\n      if (tipo === \"novedad\" && linkUrl && !isValidUrl(linkUrl)) {\r\n        markInvalid(linkUrlEl, \"URL inválida\");\r\n        showStatus(\"URL inválida: Enlace\", \"err\");\r\n        return;\r\n      }\r\n\r\n      if (excerpt && excerpt.length > 240) {\r\n        markInvalid(excerptEl, \"Máximo 240 caracteres\");\r\n        showStatus(\"Resumen demasiado largo (máx 240)\", \"err\");\r\n        return;\r\n      }\r\n\r\n      const body: any = { tipo, titulo, blocksJson: blocks };\r\n      if (excerpt) body.excerpt = excerpt;\r\n      if (destacado) body.destacado = true;\r\n      if (portada) body.portadaUrl = portada;\r\n      if (tipo === \"novedad\" && linkUrl) body.linkUrl = linkUrl;\r\n\r\n      if (body.destacado && !body.portadaUrl) throw new Error(\"Si es destacada, agregá una portada\");\r\n\r\n      const res = await apiPost(\"/v1/posts\", body);\r\n\r\n      if (!res.ok) {\r\n        const { text, fieldErrors } = await getErrorInfo(res);\r\n        if (fieldErrors.length) {\r\n          markFieldErrors(fieldErrors.map((fe) => ({ field: fe.field, message: fe.message || \"Dato inválido\" })));\r\n        }\r\n        showStatus(text, \"err\");\r\n        return;\r\n      }\r\n\r\n      localStorage.removeItem(CONTENT_KEY);\r\n      localStorage.removeItem(META_KEY);\r\n      dirty = false;\r\n\r\n      showStatus(\"Guardado ✅\", \"ok\");\r\n      const next = tipo === \"novedad\" ? \"/admin/novedades\" : \"/admin/noticias\";\r\n      location.href = next;\r\n    } catch (e: any) {\r\n      console.error(e);\r\n      showStatus(toErrorText(e), \"err\");\r\n    }\r\n  });\r\n\r\n  previewBtn?.addEventListener(\"click\", async () => {\r\n    try {\r\n      const data = await editor.save();\r\n      const w = window.open(\"\", \"_blank\");\r\n      w?.document.write(\r\n        `<pre style=\"padding:16px;font-family:ui-monospace,Menlo,Consolas,monospace\">${escapeHtml(\r\n          JSON.stringify(data, null, 2)\r\n        )}</pre>`\r\n      );\r\n      w?.document.close();\r\n    } catch {}\r\n  });\r\n}\r\n\r\nif (document.readyState === \"loading\") {\r\n  document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\r\n} else {\r\n  boot();\r\n}\r\n"],"names":["HeaderTool","Header","ListTool","List","ImageToolC","ImageTool","CONTENT_KEY","META_KEY","getEl","id","el","isValidUrl","str","showStatus","msg","type","statusEl","clearFieldErrors","toHumanLabel","field","markFieldErrors","fieldErrors","message","markInvalid","escapeHtml","m","dirty","metaTimer","markDirty","saveMeta","tipoEl","tituloEl","excerptEl","portadaEl","destacadoEl","linkUrlEl","meta","loadMeta","raw","bindUnsavedChangesGuard","boot","holder","DEFAULT_FOLDER","RESOURCE_TYPE","saveBtn","previewBtn","portadaFileEl","handler","clearFieldError","e","input","file","_a","assertImage","err","clearFileInput","sig","requestSignature","resp","uploadToCloudinary","metaDraft","imageToolConfig","editor","EditorJS","out","blocks","tipo","titulo","excerpt","portada","destacado","linkUrl","body","res","apiPost","text","getErrorInfo","fe","next","toErrorText","data","w"],"mappings":"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"}